# 脅威モデル

## 5.1 脅威アクター

| アクター                   | 能力                                       | 意図                                         |
| -------------------------- | ------------------------------------------ | -------------------------------------------- |
| 外部攻撃者                 | ネットワークアクセス、漏洩したシークレット | データ流出、サービス妨害                     |
| 悪意のある内部者           | Slack ワークスペースアクセス               | 不正質問、機密情報抽出、モデル乱用           |
| 侵害されたボットアカウント | フルボットトークンスコープ                 | 自動化されたプロンプト攻撃、コスト増大       |
| 好奇心旺盛なユーザー       | 正規 Slack アクセス                        | ジェイルブレイク試行、システムプロンプト抽出 |

## 5.2 脅威分析（AI 特有の脅威を含む）

| 脅威 ID  | 脅威                               | 攻撃ベクター                         | 影響                                       | 可能性 | リスク         | 緩和レイヤー                                                    |
| -------- | ---------------------------------- | ------------------------------------ | ------------------------------------------ | ------ | -------------- | --------------------------------------------------------------- |
| T-01     | 署名シークレット漏洩               | GitHub コミット、ログ露出、内部者    | リクエスト偽造（但し実在エンティティのみ） | 中     | 中（従来: 高） | Slack API Existence Check、SlackEventHandler 認可、モニタリング |
| T-02     | Slack アカウント乗っ取り           | フィッシング、認証情報総当たり       | 不正質問実行                               | 中     | 高             | SSO+MFA、IP 制限                                                |
| T-03     | リプレイアタック                   | ネットワークキャプチャ               | 重複質問実行                               | 低     | 中             | タイムスタンプ検証、nonce 追跡                                  |
| T-04     | Function URL 漏洩                  | ログ露出、ドキュメント               | 直接呼び出し試行                           | 高     | 中             | 署名検証（シークレットなしで失敗）                              |
| T-05     | SlackEventHandler IAM ロール侵害   | AWS 認証情報漏洩                     | 内部 API アクセス                          | 低     | 致命的         | 最小権限、認証情報ローテーション                                |
| T-06     | コマンドインジェクション           | サニタイズされていない Slack 入力    | BedrockProcessor でのコード実行            | 低     | 致命的         | 入力検証、パラメータ化クエリ                                    |
| T-07     | DDoS / レート乱用                  | Slack API 自動化                     | サービス利用不可、高額コスト               | 中     | 中             | WAF レート制限、ユーザー単位スロットリング                      |
| T-08     | 権限昇格                           | 誤設定された IAM ポリシー            | 不正リソースアクセス                       | 低     | 高             | IAM ポリシーレビュー、最小権限                                  |
| **T-11** | **モデル乱用（コスト）**           | **大量リクエスト、長いコンテキスト** | **高額な Bedrock コスト**                  | **高** | **中**         | **トークン制限、クォータ**                                      |
| **T-12** | **コンテキスト履歴からの情報漏洩** | **他ユーザーのコンテキストアクセス** | **機密情報露出**                           | **低** | **高**         | **コンテキスト ID の分離、アクセス制御**                        |

**リスク評価**: 致命的 = 即時対応、高 = 優先修正、中 = 計画的緩和、低 = モニタリング

### T-01 詳細分析: 署名シークレット漏洩時の防御メカニズム

Slack API Existence Check により、署名シークレット漏洩時のリスクは「高」から「中」に軽減されます：

**攻撃シナリオ 1: Signing Secret のみ漏洩**

- 攻撃者は正しい署名を生成可能
- 任意の team_id/user_id/channel_id を使用したリクエストは Existence Check で失敗
- Slack API 呼び出しには Bot Token が必要（攻撃者は持っていない）
- **結果**: 攻撃はブロックされる

**攻撃シナリオ 2: 実在エンティティへの攻撃**

- 攻撃者が正規の team_id/user_id/channel_id を発見
- Existence Check は通過（実在するため）
- しかし、認可レイヤー（ホワイトリスト）で検出可能
- **結果**: 認可レイヤーで防御

**攻撃シナリオ 3: Signing Secret + Bot Token の両方漏洩**

- 両方の鍵が漏洩した場合、Existence Check は突破される
- これは正規ワークスペースの完全侵害を意味する
- **結果**: Guardrails などの後続レイヤーで防御

**セキュリティ原則**: 防御の深層化（Defense in Depth）

- Existence Check は単独の防御ではなく、多層防御の 1 層として機能
- Signing Secret 漏洩の影響範囲を大幅に縮小

---

## 関連ドキュメント

- [セキュリティ要件](./requirements.md) - 機能的・非機能的セキュリティ要件
- [セキュリティ実装](./implementation.md) - 多層防御の実装詳細
- [アーキテクチャ概要](../architecture/overview.md) - セキュリティ設計の原則
- [テストと検証](../operations/testing.md) - セキュリティ検証シナリオ
- [ADR-004](../adr/004-slack-api-existence-check.md) - Existence Check の採用理由
