# コストとリソース

**目的**: 本システムの運用に必要な AWS リソース、コスト要因、概算、運用負荷を意思決定者に伝える。
**対象読者**: 意思決定者（経営層、マネージャー、プロダクトオーナー）
**最終更新日**: 2026-02-14

---

## 概要

本システムは AWS 上で稼働し、Slack と連携して AI 機能を提供します。ここでは利用する主な AWS サービス、コストに影響する要因、想定されるコストの目安、および運用に必要なリソースをまとめます。具体的な料金は利用量とリージョンにより変動するため、正式な見積もりは AWS の料金ページおよび Cost Explorer で確認してください。

---

## 利用する主な AWS サービス

| サービス | 役割 | 備考 |
|----------|------|------|
| **AWS Lambda** | Slack からのリクエスト受付、イベント処理、キュー駆動、Slack への返信投稿 | 従量課金。リクエスト数と実行時間に応じて課金。 |
| **Amazon DynamoDB** | ホワイトリスト・認可設定、イベント重複排除、Existence Check キャッシュ、レート制限、トークン保存 | 読み書き容量とストレージに応じて課金。 |
| **Amazon S3** | 一時ファイルの受け渡し（画像・ドキュメント添付時） | ストレージとリクエスト数に応じて課金。 |
| **Amazon Bedrock** | 基盤モデル（LLM）の呼び出し、Guardrails | 入力・出力トークン数およびモデル種類に応じて課金。主要なコスト要因。 |
| **Amazon Bedrock AgentCore** | 検証エージェント・実行エージェントのコンテナ実行環境 | ランタイムの稼働時間等に応じて課金。 |
| **Amazon ECR** | 検証・実行エージェント用コンテナイメージの保管 | ストレージとデータ転送に応じて課金。 |

このほか、CloudWatch（ログ・メトリクス）、Secrets Manager（オプションで認可情報の保存）、IAM 等を利用します。

---

## コストに影響する要因

- **利用量**: メンションやメッセージ数、添付ファイルの数・サイズが増えると、Lambda 実行、Bedrock のトークン消費、S3/DynamoDB の利用が増えます。
- **Bedrock の利用**: 質問の長さ・回答の長さ・モデル選択により、トークン単価と総コストが大きく変わります。Guardrails の利用もコストに含まれます。
- **AgentCore**: 検証・実行エージェントの稼働時間とリソース設定がコストに影響します。
- **リージョン**: 同一サービスでもリージョンにより単価が異なります。
- **データ保持**: DynamoDB の TTL や S3 のライフサイクル、ログ保存期間を長くするとストレージコストが増えます。

---

## コストの目安（参考）

- **小規模（少数チャンネル・限定的利用）**: 月額数十ドル〜百ドル程度から想定。Lambda・DynamoDB・Bedrock の軽い利用が中心。
- **中〜大規模（全社展開・問い合わせチャンネル含む）**: 利用頻度とトークン消費に応じて数百ドル〜それ以上になる可能性があります。Bedrock のトークン単価と利用量の見積もりが重要です。

ユーザー単位の Bedrock コストを抑えるため、レート制限やトークン上限の設定を推奨しています（開発者向けセキュリティドキュメント参照）。正確な見積もりは、想定ユーザー数・メッセージ数・平均トークン数を基に AWS 料金計算や Cost Explorer で行ってください。

---

## 運用に必要なリソース

- **初期構築**: AWS アカウント、CDK によるデプロイ、Slack App の作成・設定。開発者またはインフラ担当が 1〜2 日程度かかる場合があります。
- **運用・監視**: CloudWatch によるログ・メトリクス・アラームの確認、Slack 側の Request URL や権限の維持。定期的な確認と、インシデント時の対応が可能な体制が必要です。
- **認可・設定変更**: ホワイトリスト（利用可能なチャンネル・ユーザー）の変更は DynamoDB または Secrets Manager で管理。運用ポリシーに応じて変更頻度と担当を決めることを推奨します。
- **アップデート**: CDK スタックの更新、コンテナイメージの再ビルド・再デプロイ。機能追加やセキュリティアップデートに応じて実施します。

---

## 推奨事項

- **段階的導入**: まずは限定チャンネルで利用を開始し、利用量とコストを計測したうえで範囲を拡大することを推奨します。
- **Bedrock のモデル選択**: コストと品質のバランスのため、用途に応じたモデル選択とトークン上限の設定を検討してください。
- **監視とアラート**: コスト異常を検知するため、AWS の予算アラートや Cost Anomaly Detection の利用を推奨します。
- **ドキュメント**: 詳細なデプロイ手順・運用手順は [開発者向けクイックスタート](../developer/quickstart.md) および [運用ガイド](../developer/runbook.md) を参照してください。
